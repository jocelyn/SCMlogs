<?php

if (!defined ("__QUERY_INC__")) { define ("__QUERY_INC__", True);

Function ExecuteCommand ($cmd) {
	$cmd .= " -subject \"GENERATED FROM WEB\" ";
	$cmd .= " -mesg \"Generated by the SCMLogs web interface ...\" ";
//	$result = system ($cmd );
	$out = '';
	$pipe = popen($cmd, 'r');
	if (!$pipe) { 
		$out = "Error occurred"; 
   	} else {
		while(!feof($pipe)) {
			$out .= fread($pipe, 1024);
		}
		pclose($pipe);
	}
	echo $out;
	return $out;
}

Function EmailLogsAction ($commitsfilename, $username, $filter, $only_user='', $only_tag='', $format='html', $type='filtered') {
	$cmd = SCMLogs_sendlogs_cmd()." -f $commitsfilename -p $filter ";
	if (!empty($username)) { $cmd .= " -u $username "; }
	$cmd .= " -mail -$format --$type";
	ExecuteCommand ($cmd);
	echo "EmailLogsAction  done...<br>\n";
	return $cmd;
}

Function ShowRawLogsAction ($commitsfilename, $username='', $filter, $only_user='', $only_tag='', $format='text', $type='filtered') {
	$cmd = "include $commitsfilename";
	echo "<PRE>\n";
	include $commitsfilename;
	echo "</PRE>\n";
	return $cmd;
}

Function ShowLogsAction ($commitsfilename, $username, $filter, $only_user='', $only_tag='', $format='html', $type='filtered') {
	$cmd = SCMLogs_sendlogs_cmd()." -f $commitsfilename -p $filter";
	if (!empty($username)) { $cmd .= " -u $username "; }
    $cmd .= " -out -$format --$type";
	ExecuteCommand ($cmd);
	return $cmd;
}

Function EmailMyLogsAction ($commitsfilename, $username, $filter, $only_user='', $only_tag='', $format='html', $type='filtered') {
	$cmd = SCMLogs_sendlogs_cmd()." -f $commitsfilename -p $filter ";
	if (!empty($only_user)) { $cmd .= " -only_user $only_user "; }
	if (!empty($username)) { $cmd .= " -u $username "; }
	$cmd .= " -mail -$format --$type";
	ExecuteCommand ($cmd);
	echo "EmailMyLogsAction done...<BR>\n";
	return $cmd;
}

Function ShowMyLogsAction ($commitsfilename, $username, $filter, $only_user='', $only_tag='', $format='html', $type='filtered') {
	$cmd = SCMLogs_sendlogs_cmd()." -f $commitsfilename -p $filter -out -$format";
	if (!empty($only_user)) { $cmd .= " -only_user $only_user "; }
	if (!empty($username)) { $cmd .= " -u $username "; }
	ExecuteCommand ($cmd);
	return $cmd;
}

Function EmailOnlyLogsForAction ($commitsfilename, $username, $filter, $only_user='', $only_tag='', $format='html', $type='filtered') {
	$cmd = SCMLogs_sendlogs_cmd()." -f $commitsfilename -p $filter ";
	if (!empty($only_user)) { $cmd .= " -only_user $only_user "; }
	if (!empty($only_tag)) { $cmd .= " -only_tag $only_tag "; }
	if (!empty($username)) { $cmd .= " -u $username "; }
	$cmd .= " -mail -$format --$type";
	ExecuteCommand ($cmd);
	echo "EmailOnlyLogsForAction done...<BR>\n";
	return $cmd;
}
Function ShowOnlyLogsForAction ($commitsfilename, $username, $filter, $only_user='', $only_tag='', $format='html', $type='filtered') {
	$cmd = SCMLogs_sendlogs_cmd()." -f $commitsfilename -p $filter ";
	if (!empty($only_user)) { $cmd .= " -only_user $only_user "; }
	if (!empty($only_tag)) { $cmd .= " -only_tag $only_tag "; }
	if (!empty($username)) { $cmd .= " -u $username "; }
	$cmd .= " -out -$format --$type";
	ExecuteCommand ($cmd);
	return $cmd;
}

}
?>
